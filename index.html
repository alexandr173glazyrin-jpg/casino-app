<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0a0a0c;
            --panel: #14141a;
            --accent: #00f2ff;
            --gold: #ffcc00;
            --text: #ffffff;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .top-bar {
            margin-top: 30px;
            text-align: center;
        }

        .top-bar h1 {
            font-size: 20px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: var(--accent);
            text-shadow: 0 0 15px rgba(0, 242, 255, 0.5);
        }

        /* Режимы */
        .mode-selector {
            display: flex;
            background: var(--panel);
            padding: 5px;
            border-radius: 15px;
            gap: 5px;
            margin: 25px 0;
            border: 1px solid #222;
        }

        .m-btn {
            padding: 10px 18px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            color: #555;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
        }

        .m-btn.active {
            background: #1f1f2e;
            color: var(--accent);
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.2);
        }

        /* Витрина рулетки */
        .viewport {
            position: relative;
            width: 320px;
            height: 140px;
            background: var(--panel);
            border-radius: 20px;
            border: 1px solid #2a2a35;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .pointer {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--accent);
            z-index: 10;
            transform: translateX(-50%);
            box-shadow: 0 0 15px var(--accent);
        }

        .pointer::before, .pointer::after {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
        }

        .pointer::before { top: 0; border-top: 8px solid var(--accent); }
        .pointer::after { bottom: 0; border-bottom: 8px solid var(--accent); }

        .track {
            display: flex;
            align-items: center;
            position: absolute;
            height: 100%;
            left: 0;
            will-change: transform;
        }

        .card {
            min-width: 90px;
            height: 110px;
            margin: 0 6px;
            background: #1c1c26;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #2d2d3d;
            transition: 0.3s;
        }

        .card b { font-size: 22px; margin-bottom: 2px; }
        .card span { font-size: 10px; opacity: 0.5; text-transform: uppercase; }

        /* Редкость */
        .legendary { border-color: var(--gold); color: var(--gold); background: rgba(255, 204, 0, 0.05); }
        .epic { border-color: #a333ff; color: #a333ff; }
        .common { border-color: #3d3d4d; color: #fff; }

        /* Кнопка */
        .action-btn {
            margin-top: 40px;
            width: 240px;
            height: 60px;
            background: var(--accent);
            border: none;
            border-radius: 18px;
            color: #000;
            font-size: 16px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.3s;
        }

        .action-btn:disabled {
            background: #222;
            color: #444;
            cursor: not-allowed;
        }

        #result-popup {
            position: fixed;
            top: 15%;
            font-size: 40px;
            font-weight: 900;
            color: var(--accent);
            text-shadow: 0 0 20px rgba(0, 242, 255, 0.6);
            display: none;
            z-index: 100;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="result-popup">+100</div>

    <div class="top-bar">
        <h1>QUATRO SLOTS</h1>
    </div>

    <div class="mode-selector">
        <div class="m-btn active" id="m-classic" onclick="changeMode('classic')">Новичок</div>
        <div class="m-btn" id="m-risk" onclick="changeMode('risk')">Хайроллер</div>
        <div class="m-btn" id="m-jackpot" onclick="changeMode('jackpot')">Безумие</div>
    </div>

    <div class="viewport">
        <div class="pointer"></div>
        <div id="track" class="track"></div>
    </div>

    <button class="action-btn" id="mainBtn" onclick="spin()">Крутить за 50</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const track = document.getElementById('track');
        const mainBtn = document.getElementById('mainBtn');
        const resPopup = document.getElementById('result-popup');

        let mode = 'classic';
        let rolling = false;

        const data = {
            classic: { cost: 50, prizes: [10, 25, 50, 75, 100, 250] },
            risk: { cost: 150, prizes: [0, 50, 100, 300, 750, 1500] },
            jackpot: { cost: 500, prizes: [100, 500, 1000, 2500, 5000, 10000] }
        };

        function changeMode(m) {
            if (rolling) return;
            mode = m;
            document.querySelectorAll('.m-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('m-' + m).classList.add('active');
            mainBtn.innerText = `Крутить за ${data[mode].cost}`;
            fillTrack();
        }

        function fillTrack() {
            track.innerHTML = '';
            track.style.transition = 'none';
            track.style.transform = 'translateX(0)';
            
            const pool = data[mode].prizes;
            for (let i = 0; i < 90; i++) {
                const val = pool[Math.floor(Math.random() * pool.length)];
                const card = document.createElement('div');
                card.className = 'card ' + (val >= 1000 ? 'legendary' : (val >= 300 ? 'epic' : 'common'));
                card.innerHTML = `<b>${val}</b><span>фишек</span>`;
                track.appendChild(card);
            }
        }

        function spin() {
            if (rolling) return;
            rolling = true;
            mainBtn.disabled = true;
            resPopup.style.display = 'none';

            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');

            const cardWidth = 102; // 90px + 12px margins
            const winIdx = 70 + Math.floor(Math.random() * 10);
            const shift = -(winIdx * cardWidth) + (160 - cardWidth/2);

            track.style.transition = 'transform 6s cubic-bezier(0.15, 0, 0.05, 1)';
            track.style.transform = `translateX(${shift}px)`;

            setTimeout(() => {
                const winCard = track.children[winIdx];
                const amount = winCard.querySelector('b').innerText;
                
                resPopup.innerText = '+' + amount;
                resPopup.style.display = 'block';
                
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');

                // Передаем данные боту и позволяем крутить снова через паузу
                setTimeout(() => {
                    tg.sendData(amount);
                    // Разблокируем кнопку для повторной игры без перезагрузки
                    rolling = false;
                    mainBtn.disabled = false;
                    fillTrack(); 
                }, 2000);
            }, 6200);
        }

        fillTrack();
    </script>
</body>
</html>
